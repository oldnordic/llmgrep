---
phase: 18-sqlite-backend-refactor
plan: 06
type: execute
wave: 4
depends_on: ["18-05"]
files_modified:
  - src/query.rs
autonomous: false
user_setup: []

must_haves:
  truths:
    - "All 342 existing tests pass without modification"
    - "query.rs public functions still work as wrappers"
    - "Output parity is maintained (no logic changes)"
    - "SqliteBackend trait methods produce identical output to query.rs functions"
  artifacts:
    - path: "tests/"
      provides: "Verification that all existing tests pass without modification"
      exports: ["all 342 tests passing"]
      covered_by: "Task 1"
  key_links:
    - from: "All test files"
      to: "src/query.rs public functions"
      via: "unchanged imports and function signatures"
      pattern: "use llmgrep::query::search_symbols|search_references|search_calls"
---

<objective>
Verify all existing tests pass without modification, confirming zero breaking changes and output parity.

Purpose: Prove that the refactoring maintained complete backward compatibility and output parity. No test code changes are allowed—if tests fail, fix the implementation, not the tests.
Output: All 342 tests passing, confirming successful refactoring.
</objective>

<execution_context>
@/home/feanor/.claude/get-shit-done/workflows/execute-plan.md
@/home/feanor/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/018-sqlite-backend-refactor/18-05-SUMMARY.md
@.planning/phases/018-sqlite-backend-refactor/18-02-SUMMARY.md
@.planning/phases/018-sqlite-backend-refactor/18-03-SUMMARY.md
@.planning/phases/018-sqlite-backend-refactor/18-04-SUMMARY.md
@.planning/phases/017-backend-infrastructure/17-05-SUMMARY.md
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/query.rs
@src/backend/sqlite.rs
@tests/
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete SqliteBackend trait implementation with query.rs wrapper functions maintained</what-built>
  <how-to-verify>
    1. Run the full test suite:
       ```bash
       cargo test --all 2>&1 | tee test_output.txt
       ```

    2. Check the test summary at the end. Verify:
       - Test result: ok. (passed)
       - All 342 tests pass (or the count from Phase 17)
       - 0 failed, 0 ignored

    3. If any tests fail:
       - Read the failure output carefully
       - Check if the failure is due to a logic change (not allowed) or a compilation issue
       - Fix the implementation in sqlite.rs or query.rs—DO NOT modify tests

    4. Run specific test subsets to verify:
       ```bash
       cargo test --lib search_tests
       cargo test --lib ast_tests
       cargo test --lib integration_tests
       cargo test --lib unit_tests
       ```

    5. Verify output parity by running a manual test:
       ```bash
       llmgrep search --db .codemcp/codegraph.db --query "main" --limit 5
       ```
       Compare the output to pre-refactor behavior (should be identical).

    Expected outcome:
    - All tests pass without modification
    - No new warnings introduced
    - Output is identical to pre-refactor implementation
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe the failures to investigate</resume-signal>
</task>

</tasks>

<verification>
1. Full test suite passes: cargo test --all
2. Test count matches or exceeds Phase 17 baseline (342 tests)
3. No tests were modified
4. Manual search command produces expected output
5. No new compiler warnings
</verification>

<success_criteria>
- [ ] All 342+ existing tests pass
- [ ] Zero test modifications
- [ ] Output parity confirmed (manual test)
- [ ] No new warnings
- [ ] SqliteBackend fully functional
</success_criteria>

<output>
After completion, create `.planning/phases/018-sqlite-backend-refactor/18-06-SUMMARY.md`
</output>
